---
title: "report"
author: "José Ferreira"
date: "13 de Março de 2017"
output:
  html_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load, include=FALSE ,echo=FALSE}
##source("main.R")
load.image("session.RData")

```

# Frequent Pattern Mining and Association Rules

This case study targets the analysis of a dataSet with detailed road safety data
provided by the department of transport of the UK government and the purpose is to find interesting rules or patterns on the circumstances of traffic road accidents.

Find the most popular items on the rules, relation between them, rules with high quality values, relation between different measures of interest, etc.

## Pipeline 

The work has been divided into 3 phases :

  - raw data transformation into transaction data
  - itemSet generation and quality assessment
  - rule extraction and quality assessment

### raw data transformation into transaction data ###

This transformation process implies several choices:

  - NA elimination
  - enforce variable domain
  - apply discretization method
  - variable selection/filtering
  
  
```{r raw}
summary(raw)
```


The following variables were selected from the raw dataframe:

  - '1st_Road_Class'
  - `2nd_Road_Class` 
  - Road_Type 
  - Speed_limit 
  - Weather_Conditions
  - Light_Conditions 
  - Road_Surface_Conditions 
  
  - Police_Force 
  - Accident_Severity
  - Number_of_Vehicles
  - Number_of_Casualties 




```{r transactions}
summary(transactions)
```




### itemsets generation ###

In this phase i've decided not to do frequent itemSet analysis on the whole transaction matrix. Instead, i´ve computed a dissimilarity matrix on a 15.000 lenght sample and labled the whole transaction set in 6 clusters.


####cluster results ####

```{r diss}
summary(silhouette)
```

```{r cluster}
summary(c)
```

For each cluster frequent Items, max frequent items, and closed items can be computed
with specified support and target(target can be all transactions or individually chosen cluster)


```{r freqItems}
for (i in 1:6)
{
  itemFrequencyPlot(c[[i]], population = transactions, support = 0.2)
}
```

```{r freqItemsQ}
for (i in 1:6)
{
    inspect(head(freqItemsByCluster[[i]],5,by="lift"))
}
```



### rules extraction ###

As in the previous process rules were extracted per cluster.
The following rules were mined using 0.05 as minSupport,0.5 as minConfidence and with sizes between 2 and 8.


```{r rules}

for(i in 1:6)
{
  plot(head(sort(rulesByCluster[[i]] , decreasing = TRUE), 5),method="graph", control=list(cex=.7))
  inspect(head(sort(rulesByCluster[[i]],by="lift"),5))
}
```

